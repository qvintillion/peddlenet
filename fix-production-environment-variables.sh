#!/bin/bash

# ğŸ¯ PRODUCTION VS PREVIEW ENVIRONMENT ISSUE
# ==========================================

set -e

echo "ğŸ¯ PRODUCTION VS PREVIEW ENVIRONMENT ISSUE DETECTED"
echo "=================================================="
echo ""

echo "âœ… GOOD NEWS: Preview deployments are working!"
echo "âŒ ISSUE: Production deployments are failing!"
echo ""
echo "This means the code is fine, but there's an environment-specific issue."
echo ""

echo "ğŸ” ANALYSIS FROM VERCEL LIST:"
echo "============================="
echo "âœ… Working: https://festival-chat-ampz5sqdg-thepeddlers-projects-d74f9d42.vercel.app (Preview)"
echo "âŒ Failing: https://festival-chat-k6a5fbujy-thepeddlers-projects-d74f9d42.vercel.app (Production)"
echo ""

echo "ğŸ¯ MOST LIKELY CAUSE: Missing Production Environment Variables"
echo "============================================================="
echo ""
echo "Preview has the staging environment variables, but Production is missing them!"
echo ""

echo "ğŸ”§ IMMEDIATE FIX:"
echo "================"
echo ""
echo "1. ğŸŒ Go to Vercel Dashboard:"
echo "   https://vercel.com/dashboard"
echo ""
echo "2. ğŸ“ Find your 'festival-chat' project"
echo ""
echo "3. âš™ï¸ Go to Settings â†’ Environment Variables"
echo ""
echo "4. ğŸ” Check if these variables exist for PRODUCTION:"
echo "   - NEXT_PUBLIC_SIGNALING_SERVER"
echo "   - BUILD_TARGET"
echo "   - NODE_ENV"
echo "   - PLATFORM"
echo ""
echo "5. â• If missing, add them for Production environment:"
echo ""
echo "   NEXT_PUBLIC_SIGNALING_SERVER = wss://peddlenet-websocket-server-hfttiarlja-uc.a.run.app"
echo "   BUILD_TARGET = production"  
echo "   NODE_ENV = production"
echo "   PLATFORM = vercel"
echo ""

echo "ğŸš€ ALTERNATIVE QUICK FIX:"
echo "========================="
echo ""
echo "Since Preview works, let's test the working preview URL:"
echo ""
echo "1. ğŸ§ª Test the working preview:"
echo "   https://festival-chat-ampz5sqdg-thepeddlers-projects-d74f9d42.vercel.app"
echo ""
echo "2. ğŸ“Š Check admin dashboard:"
echo "   https://festival-chat-ampz5sqdg-thepeddlers-projects-d74f9d42.vercel.app/admin-analytics"
echo ""
echo "3. ğŸ” Verify environment detection:"
echo "   - Should show 'STAGING' (yellow)"
echo "   - Should show 'vercel-preview' platform"
echo ""

echo "ğŸ“‹ STEP-BY-STEP FIX:"
echo "==================="
echo ""
echo "Step 1: Test working preview"
echo "  â†’ Open working preview URL above"
echo "  â†’ Confirm it works correctly"
echo ""
echo "Step 2: Copy environment variables"
echo "  â†’ Go to Vercel Dashboard â†’ Settings â†’ Environment Variables"
echo "  â†’ Copy all Preview variables to Production"
echo "  â†’ Change values to production equivalents"
echo ""
echo "Step 3: Redeploy production"
echo "  â†’ vercel --prod --force"
echo ""

echo "ğŸ‰ EXPECTED RESULT:"
echo "=================="
echo ""
echo "After setting production environment variables:"
echo "âœ… Production deployment will work"
echo "âœ… https://peddlenet.app will be accessible"
echo "âœ… Admin dashboard will show 'PRODUCTION' (red)"
echo ""
echo "The preview already works, so this is definitely an environment variable issue!"
